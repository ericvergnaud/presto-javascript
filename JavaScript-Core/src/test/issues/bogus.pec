define Sector as storable category with attribute name
define name as storable Text attribute

define Market as storable category with attributes marketCode, name and country
define marketCode as storable Text attribute matching "[A-Z]{3}"
define country as storable Country attribute

define Country as storable category with attributes name and countryCode
define countryCode as storable Text attribute matching "[A-Z]{2}"

define Stock as storable category with attributes symbol, name, sector and market
define symbol as storable Text attribute
define sector as storable Sector attribute
define market as storable Market attribute

define htmlDecode as method receiving Text data doing:
	return data
	
define importNYSEStocks as method doing:
	sectors = mutable {} as Sector{}
	market = fetch one Market where marketCode = "XNYS"
	docs = [] as Document[]
	for each doc in docs:
		sectorName = doc.sector as Text
		sector = sectors[sectorName]
		if sector is nothing:
			sector = fetch one Sector where name = sectorName
			if sector is nothing:
				sector = Sector with sectorName as name
				store sector
			sectors[sectorName] = sector
		doc.sector = sector
		doc.name = htmlDecode (doc.name as Text)
		stock = Stock from doc, with market as market
		previous = fetch one Stock where symbol = stock.symbol
		delete previous and store stock
